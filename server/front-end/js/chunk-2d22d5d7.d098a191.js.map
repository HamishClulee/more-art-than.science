{"version":3,"sources":["webpack:///./src/views/posts/live/sharedcode.md"],"names":["module","exports"],"mappings":"iGAAAA,EAAOC,QAAU","file":"js/chunk-2d22d5d7.d098a191.js","sourcesContent":["module.exports = \"<h1 id=\\\"one-build-system---multiple-apps---shared-components\\\">One Build System - Multiple Apps - Shared Components</h1>\\n<h2 id=\\\"how-to-achieve-this-and-how-to-maintain-developer-experience-while-doing-so\\\">How to achieve this and how to maintain developer experience while doing so.</h2>\\n<p><em>Last updated September 12, 2020</em></p>\\n<blockquote>\\n<p>Written with specific references to VueCli v3, but I think a good portion of whats contained within should be applicable across most FE codebases.</p>\\n</blockquote>\\n<h3 id=\\\"the-what-and-the-why\\\">The What And The Why</h3>\\n<p>While working on WelcomeQr I was in a position where it made sense to create a seperate app for serving published content at a user&#39;s subdomain. So, I started by making a new app scafolled using VueCli located at the root on my current mono repo for the project. Prior to the subdoms app, the repo contained a frontend application and an ExpressJs server for endpoints, database and serving static content (static could possibly have been done faster at the Nginx level, but that&#39;s another story, and I&#39;m happy with the current set up). So now I have two seperate Frontend apps, two build systems, two lint configs and I haven&#39;t even started writing code yet. Pretty early on in writing the new app I start using components from the main app, at this stage by just copying them into the new directory.</p>\\n<p>So, that is also the <em>why</em>. I wanted to manage all my frontend code using one build and lint setup (I&#39;m using typescript so linting etc is a little more complex, and therefore makes using one config all the more important.)</p>\\n<h3 id=\\\"things-i-tried-on-the-road-to-completetion\\\">Things I Tried On The Road To Completetion</h3>\\n<p>I generally start things in a naive manner and that&#39;s by no means a negative. I find when I&#39;m attempting something that is new to me making a branch and trying to go directly from A to B has been useful and effective. Sometimes it works first time, other times not so much, this was the latter.</p>\\n<p>First thing I tried to do was simply make a shared folder at the root of repo and move all the shared code into it, then change the paths in both apps that referenced anything shared. Guess the problem? No linting or typechecking, also my <code>sass</code> variables and the interpolation into each <code>.vue</code> file went to custard at this point.</p>\\n<p>Ok, so no problems, I&#39;ll move the tsconfig file into the root of the project, but then of course I&#39;ll need to install some tooling, also my server is running it&#39;s own seperate typescript tooling, and that would now be upstream from the new tsconfig. It&#39;s quickly becoming obvious that this isn&#39;t going to be a quick fix. Time for lunch.</p>\\n<p>The next thing I tried doing was using two distinct <code>vue.config.[app-name].js</code> files, and the Vue env variable: <code>VUE_CLI_SERVICE_CONFIG_PATH</code>. I found a couple of references to it from the author of <a href=\\\"https://serebrov.github.io/html/2020-05-03-vue-cli-multiple-configs.html\\\">this</a> post, who found it buried in the Vue source code, it&#39;s not documented, but I looked at the source and it seemed legit - famous last words right?</p>\\n<p>I did actually think that this would be a winner for a while, but got backed into a corner by realtive paths and needing to have two very different <code>index.html</code> files for each app, I could be wrong here but the results I was getting seemed like a bug in VueCli, of course, because what I&#39;m doing isn&#39;t in the docs, it&#39;s probably not defined as a bug? Right?  <code>¯\\\\_(ツ)_/¯</code></p>\\n<p>The code below is the first attempt at splitting the <code>vue.config.js</code> files, taken from the <code>package.json</code> scripts section.</p>\\n<pre><code class=\\\"language-javascript\\\">  &quot;scripts&quot;: {\\n\\n    &quot;serve:main&quot;: &quot;env VUE_CLI_SERVICE_CONFIG_PATH=\\\\&quot;$PWD/vue.config.main.js\\\\&quot; vue-cli-service serve main-app/src/main.ts --dest main-app/dist&quot;,\\n    &quot;build:main&quot;: &quot;env VUE_CLI_SERVICE_CONFIG_PATH=\\\\&quot;$PWD/vue.config.main.js\\\\&quot; vue-cli-service build --dest main-app/dist main-app/src/main.ts&quot;,\\n\\n    &quot;serve:subdoms&quot;: &quot;env VUE_CLI_SERVICE_CONFIG_PATH=\\\\&quot;$PWD/vue.config.subdoms.js\\\\&quot; vue-cli-service serve subdoms-app/src/main.ts&quot;,\\n    &quot;build:subdoms&quot;: &quot;env VUE_CLI_SERVICE_CONFIG_PATH=\\\\&quot;$PWD/vue.config.subdoms.js\\\\&quot; vue-cli-service build --dest subdoms-app/dist subdoms-app/src/main.ts&quot;\\n\\n  },</code></pre>\\n<p>And the <code>vue.config.main-app.js</code> file.</p>\\n<pre><code class=\\\"language-javascript\\\">const path = require(&#39;path&#39;)\\n\\nmodule.exports = {\\n    chainWebpack: config =&gt; {\\n\\n        // I&#39;ve ommited stuff that isn&#39;t super relevant\\n\\n        config.resolve.alias.set(&#39;@I&#39;, path.resolve(__dirname, &#39;../interfaces&#39;))\\n        config.resolve.alias.set(&#39;@shared&#39;, path.resolve(__dirname, &#39;./shared&#39;))\\n\\n    }\\n}</code></pre>\\n<p>It <em>does work</em> but it produced some strange results, and I think I found a better solution which stayed closer to the documented way of doing things.</p>\\n<h3 id=\\\"vuecli-limitations\\\">VueCli Limitations</h3>\\n<blockquote>\\n<p>Disclaimer: I&#39;m really liking VueCli, this is by no means a critique, but like any abstraction designed to make life easier, there is a point where if your use-case becomes sufficently different from the norm the abstraction can actually become a hinderance, I&#39;m getting pretty close to that point, but believe that this item of work should add enough future proofing so that I don&#39;t ever hit the tipping point in this project.</p>\\n</blockquote>\\n<p>Because I have enough experience writing webpack configs to have been able to achieve what I wanted by rewritting from scratch, I did come very close to removing it VueCli altogether, in the end I stayed with it, reasons to follow.</p>\\n<p>The biggest issue was the inability to configure the <code>/public</code> folder, but I got around that using some hackery, and am happy with the results. </p>\\n<h3 id=\\\"the-solution\\\">The Solution</h3>\\n<p>Apologies for the pre-amble, here is the lamb sauce.</p>\\n<h3 id=\\\"vueconfigjs\\\"><code>vue.config.js</code></h3>\\n<pre><code class=\\\"language-javascript\\\">const path = require(&#39;path&#39;)\\n\\nconst isMainApp = process.env.APP_TYPE === &#39;main-app&#39;\\nconst appDir = isMainApp ? &#39;main-app&#39; : &#39;subdoms-app&#39;\\n\\nmodule.exports = {\\n    outputDir: path.resolve(__dirname, `${appDir}/dist`),\\n    chainWebpack: config =&gt; {\\n\\n        // I&#39;ve ommited all the non-relevant config stuff\\n\\n        config.resolve.alias.set(&#39;@I&#39;, path.resolve(__dirname, &#39;../interfaces&#39;))\\n        config.resolve.alias.set(&#39;@shared&#39;, path.resolve(__dirname, &#39;./shared&#39;))\\n\\n        config.plugin(&quot;html&quot;).tap(args =&gt; {\\n            args[0].template = path.resolve(__dirname, `${appDir}/index.html`)\\n            return args\\n        })\\n\\n    },\\n    devServer: {\\n        port: isMainApp ? 8080 : 7070\\n    },\\n}</code></pre>\\n<h3 id=\\\"packagejson\\\"><code>package.json</code></h3>\\n<pre><code class=\\\"language-javascript\\\">{\\n  &quot;name&quot;: &quot;example config&quot;,\\n  &quot;version&quot;: &quot;0.1.0&quot;,\\n  &quot;scripts&quot;: {\\n\\n    &quot;serve:main&quot;: &quot;env APP_TYPE=\\\\&quot;main-app\\\\&quot; vue-cli-service serve main-app/src/main.ts&quot;,\\n    &quot;build:main&quot;: &quot;env APP_TYPE=\\\\&quot;main-app\\\\&quot; vue-cli-service build main-app/src/main.ts&quot;,\\n\\n    &quot;serve:subdoms&quot;: &quot;env APP_TYPE=\\\\&quot;subdoms-app\\\\&quot; vue-cli-service serve subdoms-app/src/main.ts&quot;,\\n    &quot;build:subdoms&quot;: &quot;env APP_TYPE=\\\\&quot;subdoms-app\\\\&quot; vue-cli-service build subdoms-app/src/main.ts&quot;\\n\\n  },\\n  &quot;dependencies&quot;: {\\n      // deps...\\n  }\\n}</code></pre>\\n<h3 id=\\\"folder-structure\\\">Folder Structure</h3>\\n<pre><code>/\\n    .git\\n    .gitignore\\n    rundev.sh\\n    deploy.sh\\n    /front\\n        /main-app\\n            /dist\\n            /src\\n            index.html\\n        /subdoms-app\\n            /dist\\n            /src\\n            index.html\\n        /public\\n            /images\\n                logo.png\\n                ...\\n            /icons\\n                check.svg\\n                ...\\n        /shared\\n            /components\\n                component.vue\\n                ...\\n            /api\\n                auth.ts\\n                api.ts\\n            /utils\\n                seo.ts\\n        jsconfig.ts\\n        eslint.js\\n        package.json\\n        vue.config.js\\n    /server\\n        ...\\n    /scripts\\n        bleh.sh\\n        ....</code></pre><h3 id=\\\"the-result\\\">The Result</h3>\\n<p>One build system, one tsconfig and linting set up, shared code and as many apps as you want all of them able to be run concurrently, and they have their own <code>sass</code> build, pretty neat right? I think this could be used to some awesome effect in larger codebases.</p>\\n<h3 id=\\\"the-drawbacks\\\">The Drawbacks</h3>\\n<p>One <code>package.json</code>, although this won&#39;t affect bundle size, because webpack on bundles whats imported, it could be argued that it will become noisy over time. It&#39;s an acceptable issue for me.</p>\\n<blockquote>\\n<p>Hope you enjoyed reading and found some of this useful.</p>\\n</blockquote>\\n<p><mark class=\\\"divider\\\">~</mark></p>\\n\";"],"sourceRoot":""}